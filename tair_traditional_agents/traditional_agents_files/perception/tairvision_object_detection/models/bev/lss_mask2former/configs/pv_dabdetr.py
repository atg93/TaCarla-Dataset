from tairvision.models.bev.lss.training.config import CfgNode as CN


def get_dab_head2d_cfg_defaults():
    HEAD2D = CN()

    HEAD2D.NUM_CLASSES = 2
    HEAD2D.SHARED_ENCODER = False
    HEAD2D.BACKBONE = "resnet50"
    HEAD2D.TRANSFORMER = CN()
    HEAD2D.TRANSFORMER.D_MODEL = 256
    HEAD2D.TRANSFORMER.NHEAD = 8
    HEAD2D.TRANSFORMER.NUM_ENCODER_LAYERS = 6
    HEAD2D.TRANSFORMER.NUM_DECODER_LAYERS = 6
    HEAD2D.TRANSFORMER.DIM_FEEDFORWARD = 2048
    HEAD2D.TRANSFORMER.DROPOUT = 0.0
    HEAD2D.TRANSFORMER.activation = "relu"
    HEAD2D.TRANSFORMER.RETURN_INTERMEDIATE_DEC = True
    HEAD2D.TRANSFORMER.NUM_FEATURE_LEVELS = 4
    HEAD2D.TRANSFORMER.DEC_N_POINTS = 4
    HEAD2D.TRANSFORMER.ENC_N_POINTS = 4
    HEAD2D.TRANSFORMER.TWO_STAGE = False
    HEAD2D.TRANSFORMER.TWO_STAGE_NUM_PROPOSALS = 300
    HEAD2D.TRANSFORMER.USE_DAB = True

    HEAD2D.DAB_PARAMS = CN()
    HEAD2D.DAB_PARAMS.NUM_QUERIES = 300
    HEAD2D.DAB_PARAMS.NUM_FEATURE_LEVELS = 4
    HEAD2D.DAB_PARAMS.AUX_LOSS = True
    HEAD2D.DAB_PARAMS.TWO_STAGE = False
    HEAD2D.DAB_PARAMS.USE_DAB = True
    HEAD2D.DAB_PARAMS.NUM_PATTERNS = 0
    HEAD2D.DAB_PARAMS.RANDOM_REFPOINTS_XY = False
    HEAD2D.DAB_PARAMS.FEATURES_SELECTED_KEYS = ['0', '1', '2']

    HEAD2D.LOSS_WEIGHT = CN()
    HEAD2D.LOSS_WEIGHT.LOSS_CE = 1.0
    HEAD2D.LOSS_WEIGHT.LOSS_BBOX = 5.0
    HEAD2D.LOSS_WEIGHT.LOSS_GIOU = 2.0
            
    HEAD2D.MATCHER_CONFIG = CN()
    HEAD2D.MATCHER_CONFIG.COST_CLASS = 1
    HEAD2D.MATCHER_CONFIG.COST_BBOX = 5
    HEAD2D.MATCHER_CONFIG.COST_GIOU = 2

    HEAD2D.PRETRAINED = True
    HEAD2D.PYRAMID_TYPE = None
    HEAD2D.PE_PARAMS = CN()
    HEAD2D.PE_PARAMS.NORMALIZE = True
    HEAD2D.PE_PARAMS.TEMPERATURE = 10000

    return HEAD2D
