from tairvision.models.bev.lss.training.config import CfgNode as CN


def get_bev_mask2former_cfg_defaults():
    DYNAMIC_TRANSFORMER_DECODER = CN()

    DYNAMIC_TRANSFORMER_DECODER.ENABLE_PIXEL_ENCODER = True
    DYNAMIC_TRANSFORMER_DECODER.PIXEL_ENCODER_CONFIG = CN()
    DYNAMIC_TRANSFORMER_DECODER.PIXEL_ENCODER_CONFIG.TRANSFORMER_DIM_FEEDFORWARD = 1024
    DYNAMIC_TRANSFORMER_DECODER.PIXEL_ENCODER_CONFIG.TRANSFORMER_DROPOUT = 0.0
    DYNAMIC_TRANSFORMER_DECODER.PIXEL_ENCODER_CONFIG.TRANSFORMER_NHEADS = 8
    DYNAMIC_TRANSFORMER_DECODER.PIXEL_ENCODER_CONFIG.TRANSFORMER_ENC_LAYERS = 6
    DYNAMIC_TRANSFORMER_DECODER.PIXEL_ENCODER_CONFIG.CONV_DIM = 256
    DYNAMIC_TRANSFORMER_DECODER.PIXEL_ENCODER_CONFIG.MASK_DIM = 256
    DYNAMIC_TRANSFORMER_DECODER.PIXEL_ENCODER_CONFIG.COMMON_STRIDE = 4
    DYNAMIC_TRANSFORMER_DECODER.PIXEL_ENCODER_CONFIG.TRANSFORMER_IN_FEATURES = ['1', '2', '3']

    DYNAMIC_TRANSFORMER_DECODER.MASKED_TRANSFORMER_DECODER_CONFIG = CN()
    DYNAMIC_TRANSFORMER_DECODER.MASKED_TRANSFORMER_DECODER_CONFIG.IN_CHANNELS = DYNAMIC_TRANSFORMER_DECODER.PIXEL_ENCODER_CONFIG.CONV_DIM
    DYNAMIC_TRANSFORMER_DECODER.MASKED_TRANSFORMER_DECODER_CONFIG.HIDDEN_DIM = 256
    DYNAMIC_TRANSFORMER_DECODER.MASKED_TRANSFORMER_DECODER_CONFIG.NUM_QUERIES = 600
    DYNAMIC_TRANSFORMER_DECODER.MASKED_TRANSFORMER_DECODER_CONFIG.NHEADS = 8
    DYNAMIC_TRANSFORMER_DECODER.MASKED_TRANSFORMER_DECODER_CONFIG.DIM_FEEDFORWARD = 2048
    DYNAMIC_TRANSFORMER_DECODER.MASKED_TRANSFORMER_DECODER_CONFIG.DEC_LAYERS = 10
    DYNAMIC_TRANSFORMER_DECODER.MASKED_TRANSFORMER_DECODER_CONFIG.PRE_NORM = False
    DYNAMIC_TRANSFORMER_DECODER.MASKED_TRANSFORMER_DECODER_CONFIG.MASK_DIM = DYNAMIC_TRANSFORMER_DECODER.PIXEL_ENCODER_CONFIG.MASK_DIM
    DYNAMIC_TRANSFORMER_DECODER.MASKED_TRANSFORMER_DECODER_CONFIG.ENFORCE_INPUT_PROJECT = False
    DYNAMIC_TRANSFORMER_DECODER.MASKED_TRANSFORMER_DECODER_CONFIG.INCLUDE_REGRESSION = False
    DYNAMIC_TRANSFORMER_DECODER.MASKED_TRANSFORMER_DECODER_CONFIG.LANE_SPECIFIC_REGRESSION = False
    DYNAMIC_TRANSFORMER_DECODER.MASKED_TRANSFORMER_DECODER_CONFIG.CODE_SIZE = 4

    NUM_POINTS = 12544

    DYNAMIC_TRANSFORMER_DECODER.MATCHER_CONFIG = CN()
    DYNAMIC_TRANSFORMER_DECODER.MATCHER_CONFIG.COST_CLASS = 2.0
    DYNAMIC_TRANSFORMER_DECODER.MATCHER_CONFIG.COST_MASK = 5.0
    DYNAMIC_TRANSFORMER_DECODER.MATCHER_CONFIG.COST_DICE = 5.0
    DYNAMIC_TRANSFORMER_DECODER.MATCHER_CONFIG.NUM_POINTS = NUM_POINTS

    DYNAMIC_TRANSFORMER_DECODER.LOSS_CONFIG = CN()
    DYNAMIC_TRANSFORMER_DECODER.LOSS_CONFIG.EOS_COEF = 0.1
    DYNAMIC_TRANSFORMER_DECODER.LOSS_CONFIG.NUM_POINTS = NUM_POINTS
    DYNAMIC_TRANSFORMER_DECODER.LOSS_CONFIG.OVERSAMPLE_RATIO = 3.0
    DYNAMIC_TRANSFORMER_DECODER.LOSS_CONFIG.IMPORTANCE_SAMPLE_RATIO = 0.75
    DYNAMIC_TRANSFORMER_DECODER.LOSS_CONFIG.LOSSES = ["labels_ce", "efficient_masks"]

    DYNAMIC_TRANSFORMER_DECODER.LOSS_WEIGHT_DICT = CN()
    DYNAMIC_TRANSFORMER_DECODER.LOSS_WEIGHT_DICT.LOSS_CE = 2.0
    DYNAMIC_TRANSFORMER_DECODER.LOSS_WEIGHT_DICT.LOSS_MASK = 5.0
    DYNAMIC_TRANSFORMER_DECODER.LOSS_WEIGHT_DICT.LOSS_DICE = 5.0
    DYNAMIC_TRANSFORMER_DECODER.LOSS_WEIGHT_DICT.LOSS_L1 = 0.003

    DYNAMIC_TRANSFORMER_DECODER.POST_PROCESSING_CONFIG = CN()
    DYNAMIC_TRANSFORMER_DECODER.POST_PROCESSING_CONFIG.OBJECT_MASK_THRESHOLD = 0.5
    DYNAMIC_TRANSFORMER_DECODER.POST_PROCESSING_CONFIG.OVERLAP_THRESHOLD = 0.8

    return DYNAMIC_TRANSFORMER_DECODER
